<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net8.0-windows</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <PlatformTarget>x64</PlatformTarget>
    <Platforms>x64</Platforms>
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <AppendRuntimeIdentifierToOutputPath>false</AppendRuntimeIdentifierToOutputPath>
    <AppendPlatformToOutputPath>false</AppendPlatformToOutputPath>
    <OutputPath>..\bin\$(Configuration)\$(AssemblyName)\</OutputPath>
    <RootNamespace>RengaPlugin</RootNamespace>
    <AssemblyName>RengaGH</AssemblyName>
    <ProjectGuid>{F1A2B3C4-D5E6-7890-FABC-DEF123456789}</ProjectGuid>
    <UseWindowsForms>true</UseWindowsForms>
    <Nullable>disable</Nullable>
  </PropertyGroup>

  <ItemGroup>
    <None Remove="RengaInterop.dll" />
  </ItemGroup>
  
  <ItemGroup>
    <None Include="RengaGH.rndesc">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Include="RengaGHIcon.png">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>
  
    <ItemGroup>
      <Reference Include="Renga.NET8.PluginUtility">
        <HintPath>C:\Program Files\Renga Standard\RengaSDK\Net\Renga.NET8.PluginUtility.dll</HintPath>
      </Reference>
      <Reference Include="Interop.Renga">
        <HintPath>C:\Program Files\Renga Standard\RengaSDK\Samples\C#\ObjectCreation\obj\Release\Interop.Renga.dll</HintPath>
        <Private>True</Private>
      </Reference>
      <COMFileReference Include="..\..\..\tlb\RengaCOMAPI.tlb">
        <EmbedInteropTypes>false</EmbedInteropTypes>
      </COMFileReference>
      <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
    </ItemGroup>

    <!-- Reference to C++ DLL project (optional - for build order) -->
    <ItemGroup>
      <ProjectReference Include="..\RengaGeometry\RengaGeometry.vcxproj">
        <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      </ProjectReference>
    </ItemGroup>

    <!-- Copy C++ DLL to output directory -->
    <ItemGroup>
      <Content Include="..\RengaGeometry\$(Configuration)\RengaGeometry.dll" Condition="Exists('..\RengaGeometry\$(Configuration)\RengaGeometry.dll')">
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      </Content>
    </ItemGroup>
  
  <!-- Post-build event to copy to Renga plugins folder -->
  <Target Name="PostBuild" AfterTargets="Build">
    <PropertyGroup>
      <RengaPluginsPath>C:\Program Files\Renga Standard\Plugins\$(TargetName)</RengaPluginsPath>
      <CppDllPath>..\RengaGeometry\$(Configuration)\RengaGeometry.dll</CppDllPath>
    </PropertyGroup>
    <MakeDir Directories="$(RengaPluginsPath)" Condition="!Exists('$(RengaPluginsPath)')" />
    <Copy SourceFiles="$(TargetPath)" DestinationFolder="$(RengaPluginsPath)" />
    <Copy SourceFiles="$(TargetDir)$(TargetName).rndesc" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)$(TargetName).rndesc')" />
    <Copy SourceFiles="$(TargetDir)$(TargetName)Icon.png" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)$(TargetName)Icon.png')" />
    <Copy SourceFiles="$(TargetDir)Interop.Renga.dll" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)Interop.Renga.dll')" />
    <Copy SourceFiles="$(TargetDir)Renga.NET8.PluginUtility.dll" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)Renga.NET8.PluginUtility.dll')" />
    <Copy SourceFiles="$(TargetDir)Newtonsoft.Json.dll" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(TargetDir)Newtonsoft.Json.dll')" />
    <!-- Copy C++ DLL if it exists -->
    <Copy SourceFiles="$(CppDllPath)" DestinationFolder="$(RengaPluginsPath)" Condition="Exists('$(CppDllPath)')" />
    <Message Text="RengaGH.dll and dependencies copied to $(RengaPluginsPath)" Importance="high" />
  </Target>
</Project>

